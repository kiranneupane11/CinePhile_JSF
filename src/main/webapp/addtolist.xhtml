<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">
    
    <h:head>
        <title>Playlist Manager</title>
    </h:head>
    <h:body>
        <p:graphicImage name="cinephile-logo.svg" library="logos" width="150" style="margin-bottom: 10px;" />
        
        <h:form>
            <p:panelMenu id="playlistMenu" style="width: 200px;">
                <p:submenu label="Playlists">
                    <p:menuitem value="Create New Playlist" 
                                icon="pi pi-plus"
                                onclick="PF('createPlaylistDialog').show()" />
                                
                    <c:forEach items="#{playlistBean.userPlaylist}" var="playlist">
                        <p:submenu label="#{playlist.listName}">
                            <p:menuitem value="View"
                                        icon="pi pi-folder"
                                        actionListener="#{playlistBean.selectPlaylist(playlist)}"
                                        update="movieListPanel" />
                            <p:menuitem value="Delete"
                                        icon="pi pi-trash"
                                        action="#{playlistBean.deleteList(playlist)}"
                                        update=":playlistMenu movieListPanel" />
                        </p:submenu>
                    </c:forEach>
                </p:submenu>
            </p:panelMenu>
            
            <!-- Right column: Movie List Panel -->
            <h:panelGroup id="movieListPanel">
                <h:panelGroup rendered="#{playlistBean.selectedPlaylist != null}">
                    <p:dataTable value="#{playlistBean.selectedPlaylistMovies}" var="usermovie">
                        <p:column headerText="Movie Title">
                            <h:outputText value="#{usermovie.title}" />
                        </p:column>
                        <p:column headerText="Rating">
                            <h:panelGroup layout="block" styleClass="rating-container">
                                <p:rating value="#{playlistBean.getMovieRatingAsInt(usermovie)}" 
                                          stars="10" cancel="false" readonly="true" />
                                <h:outputText value=" (#{usermovie.rating != null ? usermovie.rating : 'N/A'})" 
                                              styleClass="rating-value" />
                            </h:panelGroup>
                        </p:column>
                        <p:column headerText="Status">
                            <h:outputText value="#{usermovie.status != null ? usermovie.status : 'N/A'}" />
                        </p:column>
                    </p:dataTable>
                </h:panelGroup>
                <h:panelGroup rendered="#{playlistBean.selectedPlaylist == null}">
                    <h:outputText value="Select a playlist to view its movies." />
                </h:panelGroup>
            </h:panelGroup>
            
            <p:remoteCommand name="setSelected" 
                             actionListener="#{playlistBean.setSelectedPlaylist}"
                             process="@this"
                             update="@none">
                <f:param name="playlistName" value="" />
            </p:remoteCommand>
        </h:form>
        
        <p:dialog id="addToListDialog" 
          widgetVar="addToListDialog" 
          header="Add Movie to List" 
          modal="true" 
          resizable="false" 
          appendTo="@(body)">
    <h:form>
        <h:panelGrid columns="2" style="margin-bottom: 10px;">
            <h:outputText value="Rating:" />
            <h:panelGroup layout="block" styleClass="rating-container">
                <p:rating value="#{playlistBean.ratingAsInt}" stars="10" cancel="false" />
                <h:outputText value=" (#{playlistBean.rating})" styleClass="rating-value" />
            </h:panelGroup>
            <h:outputText value="Status:" />
            <p:selectOneMenu value="#{playlistBean.status}">
                <f:selectItem itemLabel="Watching" itemValue="Watching" />
                <f:selectItem itemLabel="Watched" itemValue="Watched" />
                <f:selectItem itemLabel="Plan to Watch" itemValue="Plan_To_Watch" />
                <f:selectItem itemLabel="Dropped" itemValue="Dropped" />
            </p:selectOneMenu>
        </h:panelGrid>
        <p:commandButton value="Add" 
                         action="#{playlistBean.addToList}" 
                         oncomplete="PF('addToListDialog').hide()" />
    </h:form>
</p:dialog>
    </h:body>
</html>